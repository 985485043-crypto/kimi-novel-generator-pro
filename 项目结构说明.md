# 项目结构说明

这个项目是一个 **全栈 Web 应用**，包含前端和后端。以下是关键文件和文件夹的说明。

## 📁 项目结构

```
kimi_novel_generator/
├── client/                    # 前端代码（用户看到的界面）
│   ├── src/
│   │   ├── pages/
│   │   │   └── Home.tsx       # 主页面（小说生成器界面）
│   │   ├── components/        # 可复用的 UI 组件
│   │   ├── lib/
│   │   │   └── trpc.ts        # 前端与后端通信配置
│   │   ├── App.tsx            # 应用主入口
│   │   └── main.tsx           # React 启动文件
│   ├── public/                # 静态资源（图片、图标等）
│   └── index.html             # HTML 主文件
│
├── server/                    # 后端代码（处理业务逻辑）
│   ├── moonshot.ts            # Moonshot AI API 调用逻辑
│   ├── novelRouter.ts         # 小说生成的 API 路由
│   ├── db.ts                  # 数据库操作函数
│   ├── routers.ts             # 所有 API 路由的总入口
│   └── _core/                 # 框架核心代码（不需要修改）
│
├── drizzle/                   # 数据库配置
│   └── schema.ts              # 数据库表结构定义
│
├── package.json               # 项目依赖和脚本配置
├── tsconfig.json              # TypeScript 配置
├── vite.config.ts             # 前端构建配置
│
├── 部署指南.md                # 详细的部署说明
├── 快速开始.md                # 快速启动指南
└── README.md                  # 项目说明
```

## 🔑 关键文件说明

### 前端文件

**`client/src/pages/Home.tsx`**
- 这是用户看到的主界面
- 包含 API Key 输入框、标题输入框、创作类型选择器
- 显示生成进度和小说内容
- 提供下载功能

### 后端文件

**`server/moonshot.ts`**
- 与 Moonshot AI API 通信
- 生成故事大纲和分段内容
- 确保内容连贯和风格一致

**`server/novelRouter.ts`**
- 定义了三个主要 API 端点：
  - `generateOutline`：生成故事大纲
  - `generateSegment`：生成单个段落
  - `getHistory`：获取历史记录
  - `deleteNovel`：删除历史记录

**`server/db.ts`**
- 数据库查询函数
- 保存和获取小说记录
- 管理用户数据

### 数据库

**`drizzle/schema.ts`**
- 定义了 `users` 表（用户信息）
- 定义了 `novels` 表（小说记录）
  - `id`：唯一标识
  - `title`：小说标题
  - `type`：创作类型
  - `content`：小说内容
  - `wordCount`：字数
  - `createdAt`：创建时间

## 🚀 工作流程

### 用户操作流程

1. 用户在网页上输入 API Key、标题、选择类型
2. 点击"开始生成小说"
3. **前端** (`Home.tsx`) 调用后端 API
4. **后端** (`novelRouter.ts`) 接收请求
5. **后端** 调用 `moonshot.ts` 与 AI 通信
6. **AI** 生成大纲和分段内容
7. **后端** 将结果返回给前端
8. **前端** 实时显示生成进度和内容
9. 生成完成后，用户可以下载或保存到历史记录

### 技术栈

| 层级 | 技术 | 说明 |
| :--- | :--- | :--- |
| **前端** | React 19 + TypeScript | 用户界面 |
| **样式** | Tailwind CSS 4 | 界面美化 |
| **后端** | Express.js + tRPC | API 服务器 |
| **数据库** | MySQL/TiDB | 数据存储 |
| **AI** | Moonshot API | 文本生成 |
| **构建** | Vite + esbuild | 代码打包 |

## 📝 如何修改应用

### 修改界面样式

编辑 `client/src/pages/Home.tsx` 中的 Tailwind CSS 类名。

### 修改 AI 提示词

编辑 `server/moonshot.ts` 中的 `systemPrompt` 和 `userPrompt`。

### 添加新的 API 端点

1. 在 `server/novelRouter.ts` 中添加新的 procedure
2. 在 `client/src/pages/Home.tsx` 中调用新的 API

### 修改数据库结构

1. 编辑 `drizzle/schema.ts`
2. 运行 `pnpm db:push` 进行迁移

## 🔧 常用命令

```bash
# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 启动生产服务器
npm run start

# 运行测试
npm run test

# 推送数据库迁移
pnpm db:push

# 代码格式化
npm run format
```

## 📚 学习资源

- **React**：https://react.dev
- **TypeScript**：https://www.typescriptlang.org
- **Tailwind CSS**：https://tailwindcss.com
- **tRPC**：https://trpc.io
- **Drizzle ORM**：https://orm.drizzle.team

---

**现在您了解了项目的结构！如果需要修改或扩展功能，请参考上面的说明。**
